@using MyEshop_Phone.Domain.Model
@model IEnumerable<_Products>
@{
    var items = Model ?? Enumerable.Empty<_Products>();
    var uniqueCategoryNames = items
        .Select(item => item.products_Groups?.GroupTitle?.Trim())
        .Where(name => !string.IsNullOrWhiteSpace(name))
        .Distinct(StringComparer.OrdinalIgnoreCase)
        .ToList();
    var uniqueBrandNames = items
        .Select(item => item.ShortDescription?.Trim())
        .Where(name => !string.IsNullOrWhiteSpace(name))
        .Distinct(StringComparer.OrdinalIgnoreCase)
        .ToList();
}


<aside id="filter-sidebar" class="filter-sidebar fixed lg:static top-0 -right-full lg:right-auto w-[86%] sm:w-[78%] md:w-80 max-w-[360px] lg:max-w-none lg:w-full h-full lg:h-auto bg-white lg:bg-transparent z-[160] lg:z-auto lg:col-span-3 lg:block p-4 lg:p-0" role="navigation" aria-label="فیلترهای محصولات">
    <div id="products-container" class="filter-panel bg-white rounded-xl border border-gray-200/80 shadow-sm lg:shadow-lg lg:p-4 flex flex-col">

        <div class="filter-panel-header flex items-center justify-between lg:hidden pb-3 border-b border-gray-200">
            <h2 class="font-bold text-lg text-[#1D1B20]">فیلترها</h2>
            <button id="close-filters-btn" class="p-2 rounded-full hover:bg-gray-100" aria-label="بستن فیلترها" type="button">
                <span class="material-icon">close</span>
            </button>
        </div>

        <!-- Search in filters -->
        <div class="p-3 border-b border-gray-200 hidden lg:block filter-search">
            <div class="search-shell relative w-full">
                <form action="/Search" method="get">
                    <input type="search" name="q" id="filter-search" placeholder="جستجو در محصولات..." class="search-input text-sm pr-3 pl-10 py-2 w-full">
                    <span class="material-icon search-icon absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">search</span>
                </form>
            </div>
        </div>

        <div class="filter-section overflow-y-auto pr-2 max-h-[calc(100vh-180px)] lg:max-h-[calc(100vh-150px)]">
            <details open class="filter-accordion">
                <summary class="filter-accordion-summary">
                    <span>دسته ها</span>
                    <span class="material-icon">expand_more</span>
                </summary>
                <div class="category-filter-list">
                    <button data-category="all" class="category-filter-btn" type="button">
                        <span class="category-label">تمام محصولات</span>
                    </button>
                    @foreach (var categoryName in uniqueCategoryNames)
                    {
                        <button data-category="@categoryName" class="category-filter-btn" type="button">
                            <span class="category-label">@categoryName</span>
                        </button>
                    }
                </div>
            </details>

            <details open class="filter-accordion">
                <summary class="filter-accordion-summary">
                    <span>فیلترها</span>
                    <span class="material-icon">expand_more</span>
                </summary>
                <div class="dynamic-filters">
                    <details class="filter-subgroup" open="">
                        <summary class="filter-subgroup-summary">
                            <span>برند</span>
                            <span class="material-icon">expand_more</span>
                        </summary><div class="filter-options">
                            @foreach (var brandName in uniqueBrandNames)
                            {
                                <label class="filter-option">
                                    <input type="checkbox" class="filter-input" value="@brandName" data-filter-key="brand" data-normalized="@brandName?.ToLowerInvariant()">
                                    <span>@brandName</span>
                                </label>
                            }
                        </div>
                    </details>
                </div>
                <div id="dynamic-filters-empty" class="filter-empty hidden">
                    <p>برای این دسته فیلتر دیگری ثبت نشده است.</p>
                </div>
            </details>

            <details open class="filter-accordion">
                <summary class="price-filter-summary">
                    <span>فیلتر قیمت</span>
                    <span class="material-icon">expand_more</span>
                </summary>
                <div class="price-range-container px-4 pt-2 pb-3">
                    <div class="price-display text-xs font-semibold text-[#1D1B20]">
                        <span>حداقل: <span id="price-min-value">0</span> تومان</span>
                        <span>حداکثر: <span id="price-max-value">50000000</span> تومان</span>
                    </div>
                    <div class="custom-range-slider price-range-slider mt-3" dir="rtl">
                        <div class="track-bg"></div>
                        <div class="range-fill" id="price-range-fill"></div>
                        <input type="range" id="price-min" min="0" max="50000000" value="0" class="range-input range-input-min" aria-label="حداقل قیمت" step="1000">
                        <input type="range" id="price-max" min="0" max="50000000" value="50000000" class="range-input range-input-max" aria-label="حداکثر قیمت" step="1000">
                    </div>
                </div>
            </details>

            <div class="filter-in-stock-panel mt-4 flex items-center justify-between gap-3 px-4 py-3 bg-[#F8F8FB] border border-gray-200/80 rounded-2xl shadow-sm" aria-live="polite">
                <p class="text-sm font-semibold text-[#1D1B20] whitespace-nowrap">کالاهای موجود</p>
                <label class="in-stock-toggle-switch" for="in-stock-toggle">
                    <input type="checkbox" id="in-stock-toggle">
                    <span class="toggle-track">
                        <span class="toggle-thumb"></span>
                    </span>
                </label>
            </div>
        </div>

        <div class="filter-actions">
            <div class="pt-3">
                <button id="reset-filters" class="w-full text-center py-3 px-4 rounded-xl bg-gray-100 text-gray-700 font-bold hover:bg-gray-200 transition" type="button" aria-label="حذف تمام فیلترها">
                    حذف فیلترها
                </button>
            </div>
            <div class="lg:hidden pt-3">
                <div class="flex gap-2">
                    <button id="apply-filters-btn" class="flex-1 py-3 px-4 rounded-xl bg-[#2563EB] text-white font-bold hover:bg-[#1D4ED8] transition" type="button">اعمال فیلترها</button>
                </div>
            </div>
        </div>
    </div>
</aside>
